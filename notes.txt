

# WHEELS ('w)

# gitlab - oreplus
SET DEMO_BOOST_ROOT=C:\repos\boost\boost_1_72_0
SET DEMO_BOOST_LIB=C:\repos\boost\boost_1_72_0\lib64-msvc-14.2
SET DEMO_SWIG_DIR=C:\repos\swigwin\swigwin-4.1.1
SET DEMO_ORE_DIR=C:\repos\oreplus\ore
SET DEMO_ORE_SWIG_DIR=C:\repos\oreswig.gitlab

# gitlab - ore
SET DEMO_BOOST_ROOT=C:\repos\boost\boost_1_72_0
SET DEMO_BOOST_LIB=C:\repos\boost\boost_1_72_0\lib64-msvc-14.2
SET DEMO_SWIG_DIR=C:\repos\swigwin\swigwin-4.1.1
SET DEMO_ORE_DIR=C:\repos\ore.gitlab
SET DEMO_ORE_SWIG_DIR=C:\repos\oreswig.gitlab

# github
SET DEMO_BOOST_ROOT=C:\repos\boost\boost_1_72_0
SET DEMO_BOOST_LIB=C:\repos\boost\boost_1_72_0\lib64-msvc-14.2
SET DEMO_SWIG_DIR=C:\repos\swigwin\swigwin-4.1.1
SET DEMO_ORE_DIR=C:\repos\ore.github
SET DEMO_ORE_SWIG_DIR=C:\repos\oreswig.github

# generate wrapper for oreswig zip file
SET DEMO_BOOST_ROOT=C:\repos\boost\boost_1_72_0
SET DEMO_BOOST_LIB=C:\repos\boost\boost_1_72_0\lib64-msvc-14.2
SET DEMO_SWIG_DIR=C:\repos\swigwin\swigwin-4.1.1
SET DEMO_ORE_DIR=C:\repos\ore.github
SET DEMO_ORE_SWIG_DIR=C:\erik\wheels\zipfiles\oreswig

# generate ore

cd %DEMO_ORE_DIR%
mkdir build
cd %DEMO_ORE_DIR%\build
set BOOST_INCLUDEDIR=%DEMO_BOOST_ROOT%
set BOOST_LIBRARYDIR=%DEMO_BOOST_LIB%
SET ZLIB_ROOT=C:\repos\vcpkg\packages\zlib_x64-windows
*********** fixme disable unneeded parts of build
cmake -DBoost_NO_WARN_NEW_VERSIONS=1 -Wno-dev -G "Visual Studio 17 2022" -A x64 ..
cmake -DBoost_NO_WARN_NEW_VERSIONS=1 -Wno-dev -G "Visual Studio 17 2022" -A x64 .. -DMSVC_LINK_DYNAMIC_RUNTIME=OFF 
cmake -DBoost_NO_WARN_NEW_VERSIONS=1 -Wno-dev -G "Visual Studio 17 2022" -A x64 .. -DORE_BUILD_DOC=OFF -DORE_BUILD_EXAMPLES=OFF -DORE_BUILD_TESTS=OFF -DORE_BUILD_APP=OFF -DQL_BUILD_BENCHMARK=OFF -DQL_BUILD_EXAMPLES=OFF -DQL_BUILD_TEST_SUITE=OFF
-> %DEMO_ORE_DIR%\build\ORE.sln

# build ore

cd %DEMO_ORE_DIR%\build
cmake --build . --config Release
cmake --build . --config Debug
-> %DEMO_ORE_DIR%\build\OREAnalytics\orea\Release\OREAnalytics-x64-mt.lib

# build ore-swig - cmake

cd %DEMO_ORE_SWIG_DIR%\OREAnalytics-SWIG\Python
mkdir build
cd %DEMO_ORE_SWIG_DIR%\OREAnalytics-SWIG\Python\build
set BOOST_INCLUDEDIR=%DEMO_BOOST_ROOT%
set BOOST_LIBRARYDIR=%DEMO_BOOST_LIB%
set PATH=%PATH%;%DEMO_SWIG_DIR%
REM SET SWIG_ROOT=%DEMO_SWIG_DIR%
cmake -Wno-dev -G "Visual Studio 17 2022" -A x64 .. -DORE=%DEMO_ORE_DIR%
cmake -Wno-dev -G "Visual Studio 17 2022" -A x64 .. -DORE=%DEMO_ORE_DIR% -DMSVC_LINK_DYNAMIC_RUNTIME=OFF 
cmake --build . --config Release
cmake --build . --config Release --clean-first --verbose > out.release.txt 2>&1
cmake --build . --config Debug
cmake --build . --config Debug --clean-first --verbose > out.debug.txt 2>&1

# use the wrapper

cd %DEMO_ORE_SWIG_DIR%\OREAnalytics-SWIG\Python\Examples

set PYTHONPATH=%DEMO_ORE_SWIG_DIR%\OREAnalytics-SWIG\Python\build;%DEMO_ORE_SWIG_DIR%\OREAnalytics-SWIG\Python\build\Release
set PYTHONPATH=%DEMO_ORE_SWIG_DIR%\OREAnalytics-SWIG\Python\build;%DEMO_ORE_SWIG_DIR%\OREAnalytics-SWIG\Python\build\Debug

python swap.py

# build ore-swig - setup.py

cd %DEMO_ORE_SWIG_DIR%\OREAnalytics-SWIG\Python
set BOOST_ROOT=%DEMO_BOOST_ROOT%
set BOOST_LIB=%DEMO_BOOST_LIB%
set ORE_DIR=%DEMO_ORE_DIR%
set PATH=%PATH%;%DEMO_SWIG_DIR%
set ORE_STATIC_RUNTIME=1
python setup.py wrap
python setup.py build
python setup.py test
python -m build --wheel

# use the wrapper

cd %DEMO_ORE_SWIG_DIR%\OREAnalytics-SWIG\Python\Examples
set PYTHONPATH=%DEMO_ORE_SWIG_DIR%\OREAnalytics-SWIG\Python\build\lib.win-amd64-cpython-310
python swap.py

# use the wheel

cd %DEMO_ORE_SWIG_DIR%\OREAnalytics-SWIG\Python\Examples
python -m venv env1
.\env1\Scripts\activate.bat
pip install %DEMO_ORE_SWIG_DIR%\OREAnalytics-SWIG\Python\dist\osre-1.8.9.1-cp310-cp310-win_amd64.whl
python swap.py
deactivate
rmdir /s /q env1

# GITHUB ACTIONS ('g)

ore.zip     - raw files produced by git-archive-all
oreswig.zip - raw files produced by git-archive-all, ran the wrapper
ore.tgz     - raw files produced by git-archive-all
oreswig.tgz - raw files produced by git-archive-all, ran the wrapper

# make the source zip file - windows
:: pip install git-archive-all
cd %DEMO_ORE_DIR%
git-archive-all ore.zip
cd %DEMO_ORE_SWIG_DIR%
git-archive-all oreswig.zip

# run the wrapper - windows
cd C:\erik\wheels\zipfiles\oreswig\OREAnalytics-SWIG\Python
set BOOST_ROOT=%DEMO_BOOST_ROOT%
set BOOST_LIB=%DEMO_BOOST_LIB%
set ORE_DIR=%DEMO_ORE_DIR%
set PATH=%PATH%;%DEMO_SWIG_DIR%
set ORE_STATIC_RUNTIME=1
python setup.py wrap

# run cibuildwheels locally - windows

cd %DEMO_ORE_SWIG_DIR%\OREAnalytics-SWIG\Python
python -m venv env1
.\env1\Scripts\activate.bat
pip install cibuildwheel

set BOOST_ROOT=%DEMO_BOOST_ROOT%
set BOOST_LIB=%DEMO_BOOST_LIB%
set ORE_DIR=%DEMO_ORE_DIR%
set PATH=%PATH%;%DEMO_SWIG_DIR%
set ORE_STATIC_RUNTIME=1

SET CIBW_BUILD=cp310-win_amd64
SET CIBW_ARCHS_WINDOWS=AMD64
SET CIBW_BUILD_VERBOSITY=2

SET CIBW_BUILD=cp37-win32
SET CIBW_ARCHS_WINDOWS=x86
SET CIBW_BUILD_VERBOSITY=2

cibuildwheel --platform windows
deactivate
rmdir /s /q env1

# LINUX ('l)

export DEMO_BOOST_DIR=/home/erik/repos/boost/install
export DEMO_ORE_DIR=/home/erik/repos/oreplus/ore
export DEMO_ORE_SWIG_DIR=/home/erik/repos/oreswig

#export BOOST_INC=/home/erik/repos/boost/install/include
#export BOOST_LIB=/home/erik/repos/boost/install/lib
export BOOST_ROOT=/home/erik/repos/boost/install

# ore - configure

cd $DEMO_ORE_DIR
mkdir build
cd $DEMO_ORE_DIR/build
cmake .. -DCMAKE_POSITION_INDEPENDENT_CODE=ON -DORE_BUILD_DOC=OFF -DORE_BUILD_EXAMPLES=OFF -DORE_BUILD_TESTS=OFF -DORE_BUILD_APP=OFF -DQL_BUILD_BENCHMARK=OFF -DQL_BUILD_EXAMPLES=OFF -DQL_BUILD_TEST_SUITE=OFF -DBoost_NO_WARN_NEW_VERSIONS=1 -DBoost_NO_SYSTEM_PATHS=1 -DBOOST_ROOT=$DEMO_BOOST_DIR

# ore - build

cd $DEMO_ORE_DIR/build
cmake --build .

# oreswig - cmake

cd $DEMO_ORE_SWIG_DIR/OREAnalytics-SWIG/Python
mkdir build
cd $DEMO_ORE_SWIG_DIR/OREAnalytics-SWIG/Python/build
export BOOST_INCLUDEDIR=$DEMO_BOOST_DIR/include
export BOOST_LIBRARYDIR=$DEMO_BOOST_DIR/lib
export PATH=$PATH%;$DEMO_SWIG_DIR
REM SET SWIG_ROOT=$DEMO_SWIG_DIR
cmake .. -DORE=$DEMO_ORE_DIR
cmake --build .
cmake --build . --clean-first --verbose > out.release.txt 2>&1

# Use the wrapper

cd $DEMO_ORE_SWIG_DIR/OREAnalytics-SWIG/Python/Examples
export PYTHONPATH=$DEMO_ORE_SWIG_DIR/OREAnalytics-SWIG/Python/build
export LD_LIBRARY_PATH=$DEMO_ORE_DIR/build/OREAnalytics/orea:$DEMO_ORE_DIR/build/OREData/ored:$DEMO_ORE_DIR/build/QuantExt/qle:$DEMO_ORE_DIR/build/QuantLib/ql:$DEMO_BOOST_DIR/lib
python3 swap.py

# oreswig - python

cd $DEMO_ORE_SWIG_DIR/OREAnalytics-SWIG/Python
export ORE=$DEMO_ORE_DIR
export BOOST_LIB=$DEMO_BOOST_DIR/lib
export BOOST_INC=$DEMO_BOOST_DIR/include
python3 setup.py wrap
python3 setup.py build
python3 -m build --wheel

-DBoost_USE_MULTITHREADED=OFF

# Use the wrapper

cd $DEMO_ORE_SWIG_DIR/OREAnalytics-SWIG/Python/Examples
export PYTHONPATH=$DEMO_ORE_SWIG_DIR/OREAnalytics-SWIG/Python/build/lib.linux-x86_64-3.10/ORE
export LD_LIBRARY_PATH=$DEMO_ORE_DIR/build/OREAnalytics/orea:$DEMO_ORE_DIR/build/OREData/ored:$DEMO_ORE_DIR/build/QuantExt/qle:$DEMO_ORE_DIR/build/QuantLib/ql:$DEMO_BOOST_DIR/lib
python3 swap.py

# Use the wheel

cd $DEMO_ORE_SWIG_DIR/OREAnalytics-SWIG/Python/Examples
python3 -m venv env1
. ./env1/bin/activate
pip install $DEMO_ORE_SWIG_DIR/OREAnalytics-SWIG/Python/dist/osre-1.8.9.1-cp310-cp310-linux_x86_64.whl
python3 swap.py
deactivate
rm -rf env1

